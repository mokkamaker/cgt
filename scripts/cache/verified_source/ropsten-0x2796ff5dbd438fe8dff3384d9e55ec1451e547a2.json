{"status": "1", "message": "OK", "result": [{"SourceCode": "//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\r\n//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\r\n//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\r\n//%%%%%%%%%%%%%%%%%%%%%%%%%%% FairExchange %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\r\n//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\r\n//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\r\n//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\r\n\r\n\r\n\r\ncontract FairExchange {\r\n\r\n    struct Instance{\r\n        uint NumberOfParties;\r\n        uint Fee;\r\n        uint JoinDeadline;\r\n        uint DeliverDeadline;\r\n        uint NumberJoined;\r\n        uint NumberDelivered;\r\n        uint[] DeliverData;\r\n        bool distributed;\r\n        mapping(uint => party) parties;\r\n    }\r\n\r\n    uint public counter;\r\n\r\n    mapping(uint => Instance) instance;\r\n\r\n    enum State {waiting, joined, delivered, finished}\r\n\r\n    struct party {\r\n\t\taddress adr;\r\n\t\tState state;\r\n\t\tuint balance;\r\n    }\r\n\r\n    function FairExchange(){\r\n        counter = 0;\r\n    }\r\n\r\n    function newInstance(\r\n            address[] AddressesOfParties,\r\n            uint _Fee, uint[] _DeliverData,\r\n            uint _JoinDeadline,\r\n            uint _DeliverDeadline\r\n            ) returns(uint){\r\n        counter += 1;\r\n        Instance inst = instance[counter];\r\n        inst.NumberOfParties = AddressesOfParties.length;\r\n        inst.Fee = _Fee;\r\n\t\tparty temp = inst.parties[1];\r\n        for(uint i = 0; i < AddressesOfParties.length; i++){\r\n            temp = inst.parties[i+1];\r\n            temp.adr = AddressesOfParties[i];\r\n            temp.state = State.waiting;\r\n        }\r\n\t\tinst.JoinDeadline = block.number + _JoinDeadline;\r\n\t\tinst.DeliverDeadline = inst.JoinDeadline + _DeliverDeadline;\r\n        for(i = 0; i < _DeliverData.length; i++)\r\n            inst.DeliverData.push(_DeliverData[i]);\r\n        inst.distributed = false;\r\n        return counter;\r\n\t}\r\n\r\n    function getData(uint index, uint number) constant returns(uint data){\r\n        if(number == 0)\r\n            return data = instance[index].DeliverData.length;\r\n        return data = instance[index].DeliverData[number-1];\r\n\t}\r\n\r\n    function status(uint index) constant returns (uint numberJoined, uint numberDelivered){\r\n\t\tnumberJoined = instance[index].NumberJoined;\r\n\t\tnumberDelivered = instance[index].NumberDelivered;\r\n\t}\r\n\r\n    function getDeadlines(uint index) constant returns(uint[2] Deadlines){\r\n        Deadlines[0] = instance[index].JoinDeadline;\r\n        Deadlines[1] = instance[index].DeliverDeadline;\r\n\t}\r\n\r\n    function deposit(uint index, uint PartyNumber) payable{\r\n        Instance inst = instance[index];\r\n\t\tif(msg.value >= inst.Fee){\r\n\t\t\tparty temp = inst.parties[PartyNumber];\r\n\t\t\ttemp.balance = msg.value - inst.Fee;\r\n\t\t\tif(msg.sender == temp.adr &&\r\n\t\t\t        temp.state == State.waiting &&\r\n\t\t\t        block.number <= inst.JoinDeadline){\r\n\t\t\t\tinst.NumberJoined += 1;\r\n\t\t\t\ttemp.state = State.joined;\r\n\t\t\t} else throw;\r\n\t\t} else throw;\r\n\t}\r\n\r\n    function deliver(\r\n            uint index,\r\n            uint PartyNumber,\r\n            uint token,\r\n            uint randomness){\r\n        Instance inst = instance[index];\r\n\t\tparty temp = inst.parties[PartyNumber];\r\n\t\tif(temp.state == State.joined &&\r\n\t\t        inst.NumberJoined == inst.NumberOfParties &&\r\n\t\t        block.number <= inst.DeliverDeadline &&\r\n\t\t        checkInput(index, PartyNumber, token, randomness)){\r\n\t\t\ttemp.state = State.delivered;\r\n\t\t\tinst.NumberDelivered += 1;\r\n\t\t}\r\n\t}\r\n\r\n    function finish(uint index, uint PartyNumber){\r\n        Instance inst = instance[index];\r\n\t\tparty temp = inst.parties[PartyNumber];\r\n\t\tif(msg.sender == temp.adr &&\r\n                inst.DeliverDeadline < block.number &&\r\n                (inst.distributed || distributeEther(index))){\r\n\t\t\ttemp.state == State.finished;\r\n            if(!msg.sender.send(temp.balance))\r\n                throw;\r\n\t\t}\r\n    }\r\n\t\r\n    function refund(uint index, uint PartyNumber){\r\n        Instance inst = instance[index];\r\n\t\tparty temp = inst.parties[PartyNumber];\r\n        if(msg.sender == temp.adr &&\r\n                temp.state == State.joined &&\r\n                inst.JoinDeadline < block.number &&\r\n                inst.NumberJoined < inst.NumberOfParties){\r\n\t\t\ttemp.state = State.finished;\r\n\t\t\tif(!msg.sender.send(inst.Fee + temp.balance))\r\n\t\t\t\tthrow;\r\n\t\t}\r\n    }\r\n\r\n    function checkInput(uint index,\r\n            uint PartyNumber,\r\n            uint token,\r\n            uint randomness)\r\n            private returns(bool){\r\n        Instance inst = instance[index];\r\n\r\n        if(inst.DeliverData[(PartyNumber-1)*2] == inst.DeliverData[PartyNumber*2-1])\r\n            return true;\r\n\r\n        if(inst.DeliverData[PartyNumber*2-1] ==\r\n                uint(sha3(token,randomness))){\r\n            inst.DeliverData[PartyNumber*2-1] = token;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function distributeEther(uint index) private returns (bool){\r\n        Instance inst = instance[index];\r\n        for(uint PartyNumber = 1;\r\n                PartyNumber <= inst.NumberOfParties;\r\n                PartyNumber++)\r\n            if(inst.parties[PartyNumber].state == State.delivered)\r\n                inst.parties[PartyNumber].balance +=\r\n                    inst.Fee +\r\n                    (inst.NumberOfParties - inst.NumberDelivered)\r\n                    *inst.Fee\r\n                    /inst.NumberDelivered;\r\n        inst.distributed = true;\r\n        return true;\r\n\t}\r\n}", "ABI": "[{\"constant\":false,\"inputs\":[{\"name\":\"AddressesOfParties\",\"type\":\"address[]\"},{\"name\":\"_Fee\",\"type\":\"uint256\"},{\"name\":\"_DeliverData\",\"type\":\"uint256[]\"},{\"name\":\"_JoinDeadline\",\"type\":\"uint256\"},{\"name\":\"_DeliverDeadline\",\"type\":\"uint256\"}],\"name\":\"newInstance\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"index\",\"type\":\"uint256\"}],\"name\":\"status\",\"outputs\":[{\"name\":\"numberJoined\",\"type\":\"uint256\"},{\"name\":\"numberDelivered\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"index\",\"type\":\"uint256\"},{\"name\":\"PartyNumber\",\"type\":\"uint256\"},{\"name\":\"token\",\"type\":\"uint256\"},{\"name\":\"randomness\",\"type\":\"uint256\"}],\"name\":\"deliver\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"index\",\"type\":\"uint256\"},{\"name\":\"number\",\"type\":\"uint256\"}],\"name\":\"getData\",\"outputs\":[{\"name\":\"data\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"index\",\"type\":\"uint256\"},{\"name\":\"PartyNumber\",\"type\":\"uint256\"}],\"name\":\"refund\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"counter\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"index\",\"type\":\"uint256\"}],\"name\":\"getDeadlines\",\"outputs\":[{\"name\":\"Deadlines\",\"type\":\"uint256[2]\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"index\",\"type\":\"uint256\"},{\"name\":\"PartyNumber\",\"type\":\"uint256\"}],\"name\":\"finish\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"index\",\"type\":\"uint256\"},{\"name\":\"PartyNumber\",\"type\":\"uint256\"}],\"name\":\"deposit\",\"outputs\":[],\"payable\":true,\"type\":\"function\"},{\"inputs\":[],\"type\":\"constructor\"}]", "ContractName": "FairExchange", "CompilerVersion": "v0.4.2+commit.af6afb04", "OptimizationUsed": "0", "Runs": "200", "ConstructorArguments": "", "EVMVersion": "Default", "Library": "", "LicenseType": "", "Proxy": "0", "Implementation": "", "SwarmSource": ""}]}